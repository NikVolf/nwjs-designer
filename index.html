<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

    <script type="text/javascript" src="bower_components/requirejs/require.js"></script>

    <script type="text/javascript">

        global.__dirname = process.execPath.substr(0,process.execPath.lastIndexOf('/'));

        var requirejs = require("requirejs");
        var diagramDB = require("./db/diagrams");
        var entitiesDB = require("./db/entities");


        requirejs.config({

            baseUrl: global.__dirname,

            paths: {
                'd3': 'bower_components/d3/d3',
                'd3utils': 'bower_components/designer/js/helpers/d3utils',
                'jquery': 'bower_components/jquery/dist/jquery',
                'handlebars': 'bower_components/handlebars/handlebars',
                'backbone': 'bower_components/backbone/backbone',
                'marionette': 'bower_components/backbone.marionette/lib/backbone.marionette',
                'underscore': 'bower_components/underscore/underscore'
            }
        });

        requirejs(["handlebars", "d3", "jquery", "underscore"], function(handlebars, d3, jquery, underscore) {
            global.Handlebars = handlebars;
            global.d3 = d3;
            global.$ = jquery;
            global._ = underscore;
            requirejs(["backbone"], function() {
                requirejs(["marionette"], function() {
                    requirejs(['app/app'], function(app) {
                        entitiesDB.listEntities(function(entities) {
                            app.start(entities);
                        });
                    });
                });
            });

            global.$(function() {

                global.refreshDiagrams = function() {
                    diagramDB.listDiagrams(function(diagrams) {
                        var html = ["<select>"];

                        for (var i = 0; i < diagrams.length; i++) {
                            html.push("<option value='" + diagrams[i] + "'>" + diagrams[i] + "</option>");
                        }

                        html.push("</select>");

                        global.$(".diagram-selector").html(html.join(""));

                        if (global.selectedDiagram)
                            global.$(".diagram-selector").val(global.selectedDiagram);

                    })
                };

                global.$(".add-diagram").on("click", function() {

                    var diagramName = prompt("New diagram", "");

                    if (diagramName) {
                        diagramDB.addDiagram(diagramName, function () {
                            global.selectedDiagram = diagramName;
                            global.refreshDiagrams();
                        })
                    }
                });

                global.refreshDiagrams();




            })



        });

    </script>

    <script type="text/javascript">

    </script>

    <link href="demo/diagram.css" rel="stylesheet" />

</head>



<body>
    <div class="diagram-selector">
    </div>

    <div class="add-diagram">
        +
    </div>

    <div class="js-graphContainer"></div>
</body>
</html>